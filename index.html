<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PebbleWay</title>
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;500;600;700&family=Comfortaa:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #ff85a2;
            --secondary: #ffd6e0;
            --accent: #ffb6c1;
            --background: #fff5f7;
            --text: #4a4a4a;
            --card-bg: #ffffff;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        [data-theme="dark"] {
            --primary: #ff85a2;
            --secondary: #ffd6e0;
            --accent: #ffb6c1;
            --background: #0a0a0a;
            --text: #ffffff;
            --card-bg: #1a1a1a;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.6);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Quicksand', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }

        h1, h2, h3, .header, .settings-title, .stats-header, .profile-section-title {
            font-family: 'Comfortaa', cursive;
            font-weight: 600;
        }

        .goal-title {
            font-family: 'Comfortaa', cursive;
            font-weight: 500;
        }

        .goal-category {
            font-family: 'Comfortaa', cursive;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .stat-value {
            font-family: 'Comfortaa', cursive;
            font-weight: 700;
        }

        .profile-name {
            font-family: 'Comfortaa', cursive;
            font-weight: 600;
            font-size: 24px;
        }

        .theme-name {
            font-family: 'Comfortaa', cursive;
            font-weight: 500;
        }

        .submit-button, .profile-button {
            font-family: 'Comfortaa', cursive;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        body {
            background: var(--background);
            color: var(--text);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: background-color 0.3s ease;
        }

        .app-container {
            width: 100%;
            max-width: 375px;
            height: 100vh;
            max-height: 812px;
            background: var(--card-bg);
            border-radius: 40px;
            overflow: hidden;
            position: relative;
            box-shadow: var(--shadow);
            transition: background-color 0.3s ease;
        }

        .page {
            display: none;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background);
            z-index: 1;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
            overflow: hidden;
        }

        .page.active {
            display: block;
            z-index: 2;
            transform: translateX(0);
        }

        .page.slide-out {
            transform: translateX(-100%);
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
            }
            to {
                transform: translateX(0);
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
            }
            to {
                transform: translateX(-100%);
            }
        }

        .home-page {
            background: var(--background);
        }

        .settings-page {
            background: var(--background);
            overflow-y: auto;
        }

        .progress-page {
            background: var(--background);
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .profile-page {
            background: var(--background);
        }

        .header {
            background: var(--primary);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 3;
        }

        .header h1 {
            margin: 0;
        }

        .add-goal-button, .settings-button, .progress-button {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .add-goal-button:hover, .settings-button:hover, .progress-button:hover {
            transform: scale(1.1);
            background: var(--accent);
        }

        .content {
            padding: 20px;
            padding-bottom: 100px;
            position: relative;
            z-index: 1;
            background: var(--background);
        }

        .goal-card {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
            transition: transform 0.3s ease;
        }

        .goal-card:hover {
            transform: translateY(-2px);
        }

        .goal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .goal-actions {
            display: flex;
            gap: 10px;
        }

        .goal-button {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            padding: 5px;
            transition: transform 0.2s ease;
        }

        .goal-button:hover {
            transform: scale(1.1);
        }

        .goal-progress {
            background: var(--secondary);
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-bar {
            background: var(--primary);
            height: 100%;
            width: 0%;
            transition: width 0.3s ease;
        }

        .goal-stats {
            display: flex;
            justify-content: space-between;
            font-size: 14px;
            color: var(--text);
            opacity: 0.8;
        }

        .modal {
            display: none;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
            border-radius: 40px;
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease-out;
        }

        .modal-content {
            background: var(--card-bg);
            padding: 20px;
            border-radius: 20px;
            width: 90%;
            max-width: 340px;
            position: relative;
            margin: 20px;
        }

        .close-button {
            position: absolute;
            right: 15px;
            top: 15px;
            background: none;
            border: none;
            font-size: 20px;
            cursor: pointer;
            color: var(--text);
            z-index: 1001;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid var(--accent);
        }

        .modal-header h2 {
            margin: 0;
            color: var(--text);
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: var(--text);
        }

        .form-group input,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            font-size: 16px;
            background: var(--background);
            color: var(--text);
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .submit-button:hover {
            background: var(--accent);
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 8px;
            color: white;
            font-weight: 500;
            transform: translateX(120%);
            transition: transform 0.3s ease;
            z-index: 1000;
        }

        .notification.active {
            transform: translateX(0);
        }

        .notification.success {
            background: #4CAF50;
        }

        .notification.error {
            background: #f44336;
        }

        .profile-container {
            padding-top: 70px;
        }

        .profile-header {
            background: var(--card-bg);
            margin: 0 0 24px 0;
            padding: 20px;
            border-radius: 0 0 24px 24px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .profile-avatar {
            width: 80px;
            height: 80px;
            border-radius: 40px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            font-size: 32px;
            box-shadow: 0 4px 20px rgba(255, 133, 162, 0.4);
            transition: transform 0.3s ease;
        }

        .profile-avatar:hover {
            transform: scale(1.05);
        }

        .profile-info {
            position: relative;
        }

        .edit-name-button {
            position: absolute;
            right: 0;
            top: 0;
            background: none;
            border: none;
            color: var(--primary);
            font-size: 20px;
            cursor: pointer;
            padding: 4px;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }

        .edit-name-button:hover {
            opacity: 1;
        }

        .name-change-form {
            display: none;
            margin-top: 12px;
        }

        .name-change-form.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .name-change-input {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--accent);
            border-radius: 12px;
            font-size: 15px;
            background: var(--card-bg);
            color: var(--text);
            margin-bottom: 8px;
        }

        .name-change-actions {
            display: flex;
            gap: 8px;
        }

        .name-change-actions button {
            flex: 1;
            padding: 8px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .name-change-actions .save {
            background: var(--primary);
            color: white;
        }

        .name-change-actions .cancel {
            background: var(--accent);
            color: var(--text);
        }

        .profile-stats {
            padding: 0 16px;
        }
        .profile-stat {
            background: linear-gradient(45deg, var(--card-bg), var(--background));
            border: 1px solid var(--accent);
            transition: transform 0.3s ease;
        }

        .profile-stat:hover {
            transform: translateY(-2px);
        }

        .profile-section {
            margin: 0 16px 16px 16px;
            background: linear-gradient(45deg, var(--card-bg), var(--background));
            border: 1px solid var(--accent);
        }

        .profile-button {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 12px 20px;
            border-radius: 12px;
            border: 1.5px solid var(--accent);
            background: linear-gradient(90deg, var(--secondary) 0%, var(--card-bg) 100%);
            color: var(--text);
            font-family: 'Comfortaa', cursive;
            font-weight: 500;
            font-size: 16px;
            box-shadow: 0 2px 8px rgba(255, 133, 162, 0.10);
            transition: background 0.2s, box-shadow 0.2s, transform 0.15s;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .profile-button:hover {
            background: linear-gradient(90deg, var(--primary) 0%, var(--accent) 100%);
            color: white;
            box-shadow: 0 6px 16px rgba(255, 133, 162, 0.18);
            transform: translateY(-2px) scale(1.04);
        }

        .profile-button.export {
            background: linear-gradient(90deg, #b2f7ef 0%, #fff5f7 100%);
            color: #2ec4b6;
            border: 1.5px solid #2ec4b6;
        }

        .profile-button.export:hover {
            background: linear-gradient(90deg, #2ec4b6 0%, #b2f7ef 100%);
            color: white;
        }

        .profile-button.import {
            background: linear-gradient(90deg, #f7d6e0 0%, #fff5f7 100%);
            color: #ff85a2;
            border: 1.5px solid #ff85a2;
        }

        .profile-button.import:hover {
            background: linear-gradient(90deg, #ff85a2 0%, #f7d6e0 100%);
            color: white;
        }

        .profile-button.delete {
            background: linear-gradient(90deg, #ff4444 0%, #ffb6b6 100%);
            color: white;
            border: 1.5px solid #ff4444;
            box-shadow: 0 2px 12px rgba(255, 68, 68, 0.12);
        }

        .profile-button.delete:hover {
            background: linear-gradient(90deg, #ff6b6b 0%, #ff4444 100%);
            color: white;
            box-shadow: 0 6px 20px rgba(255, 68, 68, 0.18);
            transform: translateY(-2px) scale(1.05);
        }

        .profile-button.logout {
            background: linear-gradient(45deg, var(--accent), var(--secondary));
            color: var(--text);
        }

        .profile-button.delete {
            background: linear-gradient(45deg, #ff4444, #ff6b6b);
            color: white;
        }

        @keyframes slideUp {
            from {
                transform: translateY(100%);
            }
            to {
                transform: translateY(0);
            }
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (min-width: 768px) {
            .app-container {
                border: 12px solid #1a1a1a;
                border-radius: 40px;
            }
        }

        /* Add settings styles */
        .settings-container {
            padding: 20px;
            padding-top: 70px;
            padding-bottom: 100px;
            overflow-y: auto;
            max-height: 100vh;
        }

        .settings-section {
            background: var(--card-bg);
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
        }

        .settings-title {
            font-family: 'Comfortaa', cursive;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text);
        }

        .settings-group {
            margin-bottom: 20px;
        }

        .settings-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text);
        }

        .settings-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            font-size: 16px;
            background: var(--card-bg);
            color: var(--text);
            cursor: pointer;
        }

        .settings-toggle {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .settings-toggle input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .settings-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: var(--accent);
            transition: .4s;
            border-radius: 24px;
        }

        .settings-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }

        input:checked + .settings-slider {
            background-color: var(--primary);
        }

        input:checked + .settings-slider:before {
            transform: translateX(26px);
        }

        .theme-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .theme-option {
            padding: 10px;
            border-radius: 8px;
            cursor: pointer;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .theme-option:hover {
            transform: scale(1.05);
        }

        .theme-preview {
            width: 100%;
            height: 60px;
            border-radius: 8px;
            margin-bottom: 5px;
        }

        .stats-widget {
            background: var(--card-bg);
            border-radius: 15px;
            padding: 15px;
            margin: 20px 16px 16px 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
        }

        .stats-header {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: var(--text);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            margin-bottom: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 10px;
            background: var(--background);
            border-radius: 10px;
            border: 1px solid var(--accent);
        }

        .completion-bar-container {
            margin-top: 15px;
        }

        .completion-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 5px;
            font-size: 14px;
            color: var(--text);
        }

        .completion-bar {
            height: 8px;
            background: var(--secondary);
            border-radius: 4px;
            overflow: hidden;
        }

        .completion-progress {
            height: 100%;
            background: var(--primary);
            transition: width 0.3s ease;
        }

        .category-select {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            font-size: 16px;
            background: var(--background);
            color: var(--text);
            cursor: pointer;
        }

        .category-select option {
            padding: 8px;
        }

        .progress-button {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .progress-button:hover {
            transform: scale(1.1);
            background: var(--accent);
        }

        .progress-container {
            padding-top: 70px;
            padding-bottom: 100px;
            min-height: 100%;
            position: relative;
        }

        /* Add momentum scrolling for iOS */
        @supports (-webkit-touch-callout: none) {
            .progress-container {
                -webkit-overflow-scrolling: touch;
                overscroll-behavior: contain;
            }
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 2px;
            margin: 10px;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 15px;
            box-shadow: var(--shadow);
        }

        .calendar-header {
            grid-column: 1 / -1;
            text-align: center;
            font-family: 'Comfortaa', cursive;
            font-weight: 600;
            font-size: 16px;
            margin-bottom: 5px;
            color: var(--text);
        }

        .calendar-weekday {
            text-align: center;
            font-weight: 600;
            color: var(--text);
            opacity: 0.7;
            padding: 2px;
            font-size: 12px;
        }

        .calendar-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            font-size: 12px;
            position: relative;
            background: var(--background);
            border: 1px solid var(--accent);
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 30px;
        }

        .calendar-day.empty {
            background: transparent;
            border: none;
            cursor: default;
        }

        .calendar-day.checked {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }

        .calendar-day.today {
            border: 2px solid var(--primary);
            font-weight: 600;
        }

        .calendar-day.missed {
            background: var(--accent);
            opacity: 0.5;
        }

        .calendar-day:hover:not(.empty) {
            transform: scale(1.1);
            z-index: 1;
        }

        .milestone-card {
            background: var(--card-bg);
            margin: 15px;
            padding: 15px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .milestone-icon {
            font-size: 32px;
            background: var(--primary);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .milestone-info {
            flex: 1;
        }

        .milestone-title {
            font-family: 'Comfortaa', cursive;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .milestone-date {
            font-size: 14px;
            color: var(--text);
            opacity: 0.8;
        }

        .progress-notes {
            background: var(--card-bg);
            margin: 15px;
            padding: 15px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
        }

        .progress-notes textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            font-size: 16px;
            background: var(--background);
            color: var(--text);
            resize: vertical;
            min-height: 100px;
            margin-top: 10px;
        }

        .progress-notes button {
            background: var(--primary);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            margin-top: 10px;
            font-family: 'Comfortaa', cursive;
        }

        .button-container {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 1000;
            background: var(--card-bg);
            padding: 10px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
        }

        .back-button {
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 5px;
            z-index: 1001;
            transition: transform 0.3s ease;
        }

        .back-button:hover {
            transform: translateY(-50%) scale(1.1);
        }

        .journal-container {
            padding-top: 70px;
            padding-bottom: 100px;
            height: 100%;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            position: relative;
        }

        .journal-entry {
            background: var(--card-bg);
            margin: 15px;
            padding: 15px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
        }

        .journal-tools {
            display: flex;
            gap: 8px;
            margin-bottom: 10px;
            flex-wrap: wrap;
        }

        .journal-tools select {
            padding: 6px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            background: var(--background);
            color: var(--text);
            font-size: 13px;
            cursor: pointer;
            flex: 1;
            min-width: 80px;
        }

        .journal-entry textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            font-size: 14px;
            background: var(--background);
            color: var(--text);
            resize: none;
            min-height: 120px;
            max-height: 200px;
            margin: 10px 0;
            font-family: 'Quicksand', sans-serif;
        }

        .journal-history {
            background: var(--card-bg);
            margin: 15px;
            padding: 15px;
            border-radius: 15px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
            margin-bottom: 80px;
        }

        .journal-history-header {
            display: flex;
            flex-direction: column;
            gap: 10px;
            margin-bottom: 15px;
        }

        .journal-filters {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .journal-filters input,
        .journal-filters select {
            padding: 6px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            background: var(--background);
            color: var(--text);
            font-size: 13px;
            flex: 1;
            min-width: 120px;
        }

        .journal-entries-list {
            max-height: none;
            overflow-y: visible;
        }

        .journal-entry-item {
            background: var(--background);
            margin: 10px 0;
            padding: 12px;
            border-radius: 10px;
            border: 1px solid var(--accent);
            transition: transform 0.3s ease;
            position: relative;
        }

        .journal-entry-date {
            font-family: 'Comfortaa', cursive;
            font-weight: 600;
            color: var(--text);
            margin-bottom: 8px;
            font-size: 13px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .journal-entry-content {
            color: var(--text);
            font-size: 13px;
            line-height: 1.4;
            white-space: pre-wrap;
            word-break: break-word;
        }

        .journal-actions {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .journal-actions button {
            flex: 1;
            padding: 8px;
            font-size: 13px;
        }

        .journal-entry-actions {
            position: absolute;
            top: 8px;
            right: 8px;
            display: flex;
            gap: 4px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .journal-entry-action {
            background: var(--card-bg);
            border: 1px solid var(--accent);
            border-radius: 4px;
            padding: 3px 6px;
            font-size: 11px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        /* Adjust font sizes for better fit */
        .size-small {
            font-size: 11px;
        }

        .size-medium {
            font-size: 13px;
        }

        .size-large {
            font-size: 15px;
        }

        /* Ensure proper scrolling on iOS */
        .journal-container {
            -webkit-overflow-scrolling: touch;
            overscroll-behavior: contain;
        }

        /* Add momentum scrolling for iOS */
        @supports (-webkit-touch-callout: none) {
            .journal-container {
                -webkit-overflow-scrolling: touch;
            }
        }

        /* Font styles */
        .font-quicksand {
            font-family: 'Quicksand', sans-serif !important;
        }

        .font-comfortaa {
            font-family: 'Comfortaa', cursive !important;
        }

        .font-arial {
            font-family: Arial, sans-serif !important;
        }

        .font-georgia {
            font-family: Georgia, serif !important;
        }

        .font-courier-new {
            font-family: 'Courier New', monospace !important;
        }

        /* Color styles */
        .color-pink {
            color: #ff69b4 !important;
        }

        .color-blue {
            color: #4682b4 !important;
        }

        .color-green {
            color: #2e8b57 !important;
        }

        .color-purple {
            color: #9370db !important;
        }

        .color-orange {
            color: #ffa07a !important;
        }

        /* Size styles */
        .size-small {
            font-size: 11px !important;
        }

        .size-medium {
            font-size: 13px !important;
        }

        .size-large {
            font-size: 15px !important;
        }

        .journal-actions {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }

        .cancel-button {
            background: var(--accent);
            color: var(--text);
            border: none;
            padding: 8px 15px;
            border-radius: 8px;
            font-size: 14px;
            cursor: pointer;
            font-family: 'Comfortaa', cursive;
        }

        .journal-history-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .journal-filters {
            display: flex;
            gap: 10px;
        }

        .journal-filters input,
        .journal-filters select {
            padding: 8px;
            border: 1px solid var(--accent);
            border-radius: 8px;
            background: var(--background);
            color: var(--text);
            font-size: 14px;
        }

        .journal-entry-item {
            position: relative;
        }

        .journal-entry-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 5px;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .journal-entry-item:hover .journal-entry-actions {
            opacity: 1;
        }

        .journal-entry-action {
            background: var(--card-bg);
            border: 1px solid var(--accent);
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .journal-entry-action:hover {
            background: var(--primary);
            color: white;
        }

        .journal-entry-action.delete:hover {
            background: #ff4444;
        }

        .journal-button {
            background: var(--primary);
            color: white;
            border: none;
            width: 45px;
            height: 45px;
            border-radius: 12px;
            font-size: 20px;
            cursor: pointer;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .journal-button:hover {
            transform: scale(1.1);
            background: var(--accent);
        }

        /* Cartoon Styles */
        .journal-cartoon {
            position: absolute;
            width: 60px;
            height: 60px;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .journal-cartoon.active {
            opacity: 1;
        }

        .cartoon-writing {
            bottom: 20px;
            right: 20px;
            animation: float 3s ease-in-out infinite;
        }

        .cartoon-reading {
            top: 20px;
            right: 20px;
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0);
            }
            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .cartoon-emoji {
            font-size: 40px;
            position: absolute;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .cartoon-emoji.active {
            opacity: 1;
            animation: bounce 2s ease-in-out infinite;
        }

        /* Animal Cartoon Styles */
        .animal-cartoon {
            position: absolute;
            width: 80px;
            height: 80px;
            pointer-events: none;
            z-index: 1;
            opacity: 0;
            transition: opacity 0.3s ease;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .animal-cartoon.active {
            opacity: 1;
        }

        .capybara-writing {
            bottom: 20px;
            right: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23A67C52"/><circle cx="35" cy="40" r="5" fill="%23000"/><circle cx="65" cy="40" r="5" fill="%23000"/><path d="M30 60 Q50 70 70 60" stroke="%23000" fill="none" stroke-width="2"/><path d="M40 30 L60 30" stroke="%23000" fill="none" stroke-width="2"/></svg>');
            animation: float 3s ease-in-out infinite;
        }

        .panda-reading {
            top: 20px;
            right: 20px;
            background-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23FFF"/><circle cx="35" cy="40" r="5" fill="%23000"/><circle cx="65" cy="40" r="5" fill="%23000"/><circle cx="35" cy="40" r="2" fill="%23FFF"/><circle cx="65" cy="40" r="2" fill="%23FFF"/><path d="M30 60 Q50 70 70 60" stroke="%23000" fill="none" stroke-width="2"/><circle cx="50" cy="30" r="8" fill="%23000"/></svg>');
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            50% {
                transform: translateY(-10px) rotate(5deg);
            }
        }

        @keyframes bounce {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.1);
            }
        }

        .animal-reaction {
            position: absolute;
            width: 40px;
            height: 40px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            opacity: 0;
            transition: all 0.3s ease;
        }

        .animal-reaction.active {
            opacity: 1;
            animation: bounce 2s ease-in-out infinite;
        }

        /* Auth Pages Styles */
        .auth-page {
            display: none;
            height: 100%;
            width: 100%;
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--background);
            z-index: 1;
            transform: translateX(100%);
            transition: transform 0.3s ease-out;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }

        .auth-page.active {
            display: block;
            z-index: 2;
            transform: translateX(0);
        }

        .auth-container {
            padding: 20px;
            padding-top: 40px;
            padding-bottom: 20px;
            min-height: 100%;
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .auth-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .auth-header h1 {
            color: var(--primary);
            margin-bottom: 8px;
            font-size: 28px;
        }

        .auth-header p {
            color: var(--text);
            opacity: 0.8;
            font-size: 16px;
        }

        .auth-form {
            background: var(--card-bg);
            padding: 24px;
            border-radius: 20px;
            box-shadow: var(--shadow);
            border: 1px solid var(--accent);
            margin: 0 auto;
            width: 100%;
            max-width: 320px;
        }

        .auth-form .form-group {
            margin-bottom: 16px;
        }

        .auth-form label {
            display: block;
            margin-bottom: 8px;
            color: var(--text);
            font-weight: 500;
            font-size: 15px;
        }

        .auth-form input {
            width: 100%;
            padding: 14px;
            border: 1px solid var(--accent);
            border-radius: 12px;
            font-size: 16px;
            background: var(--background);
            color: var(--text);
            transition: border-color 0.3s ease;
        }

        .auth-form .submit-button {
            width: 100%;
            padding: 14px;
            background: var(--primary);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.3s ease;
            margin-top: 8px;
        }

        .auth-switch {
            text-align: center;
            margin-top: 20px;
            color: var(--text);
            font-size: 15px;
        }

        .auth-error {
            color: #ff4444;
            text-align: center;
            margin-top: 12px;
            font-size: 14px;
        }

        /* iPhone-specific adjustments */
        @media (max-width: 375px) {
            .auth-container {
                padding: 16px;
                padding-top: 32px;
            }
            
            .auth-form {
                padding: 20px;
            }
            
            .auth-form input {
                padding: 12px;
            }
            
            .auth-form .submit-button {
                padding: 12px;
            }
        }
    </style>
    <!-- App Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="/icons/icon-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/icons/icon-512x512.png">
    <link rel="apple-touch-icon" href="/icons/apple-touch-icon.png">

    <!-- Splash Screens -->
    <link rel="apple-touch-startup-image" media="(device-width: 320px) and (device-height: 568px)" href="/icons/splash/splash-640x1136.png">
    <link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 667px)" href="/icons/splash/splash-750x1334.png">
    <link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 736px)" href="/icons/splash/splash-1242x2208.png">
    <link rel="apple-touch-startup-image" media="(device-width: 375px) and (device-height: 812px)" href="/icons/splash/splash-1125x2436.png">
    <link rel="apple-touch-startup-image" media="(device-width: 414px) and (device-height: 896px)" href="/icons/splash/splash-1242x2688.png">

    <!-- Theme Color -->
    <meta name="theme-color" content="#ff85a2">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="manifest" href="/manifest.json">
</head>
<body>
    <div class="app-container">
        <div class="page home-page active" id="homePage">
            <div class="header">
                <h1>PebbleWay</h1>
            </div>
            <div class="stats-widget">
                <div class="stats-header">Your Progress</div>
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-value" id="totalGoals">0</div>
                        <div class="stat-label">Total Goals</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completedGoals">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="currentStreak">0</div>
                        <div class="stat-label">Day Streak</div>
                    </div>
                </div>
                <div class="completion-bar-container">
                    <div class="completion-label">
                        <span>Overall Progress</span>
                        <span id="completionPercentage">0%</span>
                    </div>
                    <div class="completion-bar">
                        <div class="completion-progress" id="completionProgress"></div>
                    </div>
                </div>
            </div>
            <div class="content" id="goalsList">
                <!-- Goals will be added here dynamically -->
            </div>
            <div class="button-container">
                <button class="progress-button" onclick="showProgress()">üìä</button>
                <button class="journal-button" onclick="showJournal()">üìù</button>
                <button class="settings-button" onclick="showSettings()">‚öôÔ∏è</button>
                <button class="add-goal-button" onclick="showAddGoalModal()">+</button>
            </div>
        </div>

        <div class="page profile-page" id="profilePage">
            <button class="settings-button" onclick="showSettings()">‚öôÔ∏è</button>
            <button class="progress-button" onclick="showProgress()">üìä</button>
            <div class="profile-container">
                <div class="profile-header">
                    <div class="profile-avatar" id="profileAvatar">üë§</div>
                    <div class="profile-info">
                        <div class="profile-name" id="profileName">User</div>
                        <button class="edit-name-button" onclick="toggleNameChange()">‚úèÔ∏è</button>
                        <div class="name-change-form" id="nameChangeForm">
                            <input type="text" class="name-change-input" id="newNameInput" placeholder="Enter new name">
                            <div class="name-change-actions">
                                <button class="save" onclick="saveNewName()">Save</button>
                                <button class="cancel" onclick="toggleNameChange()">Cancel</button>
                            </div>
                        </div>
                        <div class="profile-email" id="profileEmail">user@example.com</div>
                    </div>
                </div>
                
                <div class="profile-stats">
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="profileGoals">0</div>
                        <div class="profile-stat-label">Total Goals</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="profileStreak">0</div>
                        <div class="profile-stat-label">Day Streak</div>
                    </div>
                    <div class="profile-stat">
                        <div class="profile-stat-value" id="profileRate">0%</div>
                        <div class="profile-stat-label">Completion Rate</div>
                    </div>
                </div>
                
                <div class="profile-section">
                    <h3 class="profile-section-title">Account Settings</h3>
                    <div class="profile-actions">
                        <button class="profile-button logout" onclick="showLogoutConfirmation()">
                            <span>üö™</span> Log Out
                        </button>
                        <button class="profile-button delete" onclick="showDeleteConfirmation()">
                            <span>üóëÔ∏è</span> Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page settings-page" id="settingsPage">
            <div class="header">
                <button class="back-button" onclick="closeSettings()">‚Üê</button>
                <h1>Settings</h1>
            </div>
            <div class="settings-container">
                <div class="settings-section">
                    <h2 class="settings-title">Appearance</h2>
                    <div class="settings-group">
                        <label class="settings-label">Dark Mode</label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="darkMode" onchange="toggleDarkMode()">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">Theme</label>
                        <div class="theme-grid" id="themeGrid">
                            <!-- Themes will be added dynamically -->
                        </div>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">Font Size</label>
                        <select class="settings-select" id="fontSize" onchange="updateFontSize()">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-title">Notifications</h2>
                    <div class="settings-group">
                        <label class="settings-label">Daily Reminders</label>
                        <label class="settings-toggle">
                            <input type="checkbox" id="dailyReminders" onchange="updateSettings()">
                            <span class="settings-slider"></span>
                        </label>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">Reminder Time</label>
                        <input type="time" class="settings-input" id="reminderTime" onchange="updateSettings()">
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-title">Advanced Settings</h2>
                    <div class="settings-group">
                        <label class="settings-label">Data Export</label>
                        <button class="profile-button" onclick="exportData()">Export Data</button>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">Data Import</label>
                        <label class="custom-file-label profile-button import" for="importFile">Choose File</label>
                        <input type="file" class="settings-input" id="importFile" accept=".json" onchange="importData(); updateSelectedFileName();">
                        <span class="selected-file-name" id="selectedFileName"></span>
                    </div>
                    <div class="settings-group">
                        <label class="settings-label">Reset All Data</label>
                        <button class="profile-button delete" onclick="resetData()">Reset Data</button>
                    </div>
                </div>

                <div class="settings-section">
                    <h2 class="settings-title">Account</h2>
                    <div class="settings-group">
                        <label class="settings-label">Account Actions</label>
                        <button class="profile-button logout" onclick="showLogoutConfirmation()">
                            <span>üö™</span> Log Out
                        </button>
                        <button class="profile-button delete" onclick="showDeleteConfirmation()">
                            <span>üóëÔ∏è</span> Delete Account
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="page progress-page" id="progressPage">
            <div class="header">
                <button class="back-button" onclick="closeProgress()">‚Üê</button>
                <h1>Progress</h1>
            </div>
            <div class="progress-container">
                <div class="calendar-grid" id="streakCalendar">
                    <!-- Calendar days will be added dynamically -->
                </div>

                <div class="milestone-card">
                    <div class="milestone-icon">üèÜ</div>
                    <div class="milestone-info">
                        <div class="milestone-title">Current Streak</div>
                        <div class="milestone-date" id="currentStreakDisplay">0 days</div>
                    </div>
                </div>

                <div class="milestone-card">
                    <div class="milestone-icon">‚≠ê</div>
                    <div class="milestone-info">
                        <div class="milestone-title">Best Streak</div>
                        <div class="milestone-date" id="bestStreakDisplay">0 days</div>
                    </div>
                </div>

                <div class="progress-notes">
                    <textarea id="progressNotes" placeholder="Add notes about your progress..."></textarea>
                    <button onclick="saveProgressNotes()">Save Notes</button>
                </div>
            </div>
        </div>

        <div class="page journal-page" id="journalPage">
            <div class="header">
                <button class="back-button" onclick="closeJournal()">‚Üê</button>
                <h1>Journal</h1>
            </div>
            <div class="journal-container">
                <div class="journal-entry">
                    <div class="journal-tools">
                        <select id="journalFont" onchange="updateJournalStyle()">
                            <option value="Quicksand">Quicksand</option>
                            <option value="Comfortaa">Comfortaa</option>
                            <option value="Arial">Arial</option>
                            <option value="Georgia">Georgia</option>
                            <option value="Courier New">Courier New</option>
                        </select>
                        <select id="journalColor" onchange="updateJournalStyle()">
                            <option value="default">Default</option>
                            <option value="pink">Pink</option>
                            <option value="blue">Blue</option>
                            <option value="green">Green</option>
                            <option value="purple">Purple</option>
                            <option value="orange">Orange</option>
                        </select>
                        <select id="journalSize" onchange="updateJournalStyle()">
                            <option value="small">Small</option>
                            <option value="medium" selected>Medium</option>
                            <option value="large">Large</option>
                        </select>
                    </div>
                    <textarea id="journalText" placeholder="Write your thoughts about your goals, challenges, and achievements..."></textarea>
                    <div class="journal-actions">
                        <button onclick="saveJournalEntry()" class="submit-button">Save Entry</button>
                        <button onclick="clearJournalEntry()" class="cancel-button">Clear</button>
                    </div>
                </div>
                
                <div class="journal-history">
                    <div class="animal-cartoon panda-reading"></div>
                    <h3 class="settings-title">Past Entries</h3>
                    <div class="journal-filters">
                        <input type="text" id="journalSearch" placeholder="Search entries..." onkeyup="filterJournalEntries()">
                        <select id="journalSort" onchange="sortJournalEntries()">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                        </select>
                    </div>
                    <div id="journalEntries" class="journal-entries-list">
                        <!-- Past entries will be added here dynamically -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="addGoalModal">
        <div class="modal-content">
            <button class="close-button" onclick="closeAddGoalModal()">√ó</button>
            <div class="modal-header">
                <h2>Add New Goal</h2>
            </div>
            <form id="addGoalForm" onsubmit="addGoal(event)">
                <div class="form-group">
                    <label for="goalTitle">Title</label>
                    <input type="text" id="goalTitle" required placeholder="Enter goal title" 
                           autocomplete="off" autocapitalize="words" inputmode="text">
                </div>
                <div class="form-group">
                    <label for="goalCategory">Category</label>
                    <select id="goalCategory" class="category-select" required>
                        <option value="">Select a category</option>
                        <option value="health">Health & Fitness</option>
                        <option value="learning">Learning & Education</option>
                        <option value="productivity">Productivity</option>
                        <option value="mindfulness">Mindfulness & Wellness</option>
                        <option value="creativity">Creativity & Hobbies</option>
                        <option value="social">Social & Relationships</option>
                        <option value="finance">Finance & Career</option>
                        <option value="other">Other</option>
                    </select>
                </div>
                <div class="form-group">
                    <label for="goalDescription">Description</label>
                    <textarea id="goalDescription" required placeholder="Describe your goal"
                             autocapitalize="sentences" inputmode="text"></textarea>
                </div>
                <div class="form-group">
                    <label for="goalTarget">Target (days)</label>
                    <input type="number" id="goalTarget" min="1" required placeholder="Enter number of days"
                           inputmode="numeric" pattern="[0-9]*">
                </div>
                <button type="submit" class="submit-button">Add Goal</button>
            </form>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <div class="page auth-page" id="loginPage">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Welcome Back!</h1>
                <p>Log in to continue your journey</p>
            </div>
            <form class="auth-form" id="loginForm" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label for="loginEmail">Email</label>
                    <input type="email" id="loginEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="loginPassword">Password</label>
                    <input type="password" id="loginPassword" required placeholder="Enter your password">
                </div>
                <button type="submit" class="submit-button">Log In</button>
                <div class="auth-error" id="loginError"></div>
                <div class="auth-switch">
                    Don't have an account? <a onclick="showSignup()">Sign Up</a>
                </div>
            </form>
        </div>
    </div>

    <div class="page auth-page" id="signupPage">
        <div class="auth-container">
            <div class="auth-header">
                <h1>Create Account</h1>
                <p>Start your goal-tracking journey</p>
            </div>
            <form class="auth-form" id="signupForm" onsubmit="handleSignup(event)">
                <div class="form-group">
                    <label for="signupName">Full Name</label>
                    <input type="text" id="signupName" required placeholder="Enter your full name">
                </div>
                <div class="form-group">
                    <label for="signupEmail">Email</label>
                    <input type="email" id="signupEmail" required placeholder="Enter your email">
                </div>
                <div class="form-group">
                    <label for="signupPassword">Password</label>
                    <input type="password" id="signupPassword" required placeholder="Create a password">
                </div>
                <div class="form-group">
                    <label for="signupConfirmPassword">Confirm Password</label>
                    <input type="password" id="signupConfirmPassword" required placeholder="Confirm your password">
                </div>
                <button type="submit" class="submit-button">Sign Up</button>
                <div class="auth-error" id="signupError"></div>
                <div class="auth-switch">
                    Already have an account? <a onclick="showLogin()">Log In</a>
                </div>
            </form>
        </div>
    </div>

    <script>
        let goals = JSON.parse(localStorage.getItem('goals')) || [];
        let streak = parseInt(localStorage.getItem('streak')) || 0;
        let lastCheckIn = localStorage.getItem('lastCheckIn');

        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} active`;
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }

        function updateStats() {
            const totalGoals = goals.length;
            const completedGoals = goals.filter(goal => goal.completed).length;
            const completionRate = totalGoals ? Math.round((completedGoals / totalGoals) * 100) : 0;

            document.getElementById('totalGoals').textContent = totalGoals;
            document.getElementById('completedGoals').textContent = completedGoals;
            document.getElementById('currentStreak').textContent = streak;
            document.getElementById('completionPercentage').textContent = `${completionRate}%`;
            document.getElementById('completionProgress').style.width = `${completionRate}%`;
        }

        function updateGoalsList() {
            const goalsList = document.getElementById('goalsList');
            goalsList.innerHTML = '';
            
            goals.forEach((goal, index) => {
                const progress = (goal.current / goal.target) * 100;
                const categoryNames = {
                    health: "Health & Fitness",
                    learning: "Learning & Education",
                    productivity: "Productivity",
                    mindfulness: "Mindfulness & Wellness",
                    creativity: "Creativity & Hobbies",
                    social: "Social & Relationships",
                    finance: "Finance & Career",
                    other: "Other"
                };
                
                const card = document.createElement('div');
                card.className = 'goal-card';
                card.innerHTML = `
                    <div class="goal-header">
                        <div class="goal-title">${goal.title}</div>
                        <div class="goal-actions">
                            <button class="goal-button" onclick="checkIn(${index})">‚úÖ</button>
                            <button class="goal-button" onclick="deleteGoal(${index})">üóëÔ∏è</button>
                        </div>
                    </div>
                    <div class="goal-category">${categoryNames[goal.category] || 'Uncategorized'}</div>
                    <div class="goal-description">${goal.description}</div>
                    <div class="goal-progress">
                        <div class="progress-bar" style="width: ${progress}%"></div>
                    </div>
                    <div class="goal-stats">
                        <span>${goal.current}/${goal.target} days</span>
                        <span>${Math.round(progress)}% complete</span>
                    </div>
                `;
                goalsList.appendChild(card);
            });
            updateStats();
        }

        function addGoal(event) {
            event.preventDefault();
            
            const title = document.getElementById('goalTitle').value;
            const category = document.getElementById('goalCategory').value;
            const description = document.getElementById('goalDescription').value;
            const target = parseInt(document.getElementById('goalTarget').value);
            
            goals.push({
                title,
                category,
                description,
                target,
                current: 0,
                completed: false
            });
            
            localStorage.setItem('goals', JSON.stringify(goals));
            updateGoalsList();
            closeAddGoalModal();
            showNotification('Goal added successfully!');
            
            event.target.reset();
        }

        function checkIn(index) {
            const today = new Date().toDateString();
            
            if (lastCheckIn === today) {
                showNotification('You have already checked in today!', 'error');
                return;
            }
            
            const goal = goals[index];
            if (goal.current < goal.target) {
                goal.current++;
                if (goal.current === goal.target) {
                    goal.completed = true;
                    showNotification('Congratulations! Goal completed! üéâ');
                }
                
                streak++;
                localStorage.setItem('streak', streak);
                localStorage.setItem('lastCheckIn', today);
                localStorage.setItem('goals', JSON.stringify(goals));
                
                updateGoalsList();
                showNotification('Check-in successful! Keep going! üí™');
            }
        }

        function deleteGoal(index) {
            if (confirm('Are you sure you want to delete this goal?')) {
                goals.splice(index, 1);
                localStorage.setItem('goals', JSON.stringify(goals));
                updateGoalsList();
                showNotification('Goal deleted successfully');
            }
        }

        function showAddGoalModal() {
            document.getElementById('addGoalModal').classList.add('active');
        }

        function closeAddGoalModal() {
            document.getElementById('addGoalModal').classList.remove('active');
        }

        function showProfile() {
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('profilePage').classList.add('active');
            
            const username = localStorage.getItem('username') || 'User';
            const email = localStorage.getItem('userEmail') || 'user@example.com';
            
            document.getElementById('profileName').textContent = username;
            document.getElementById('profileEmail').textContent = email;
            document.getElementById('profileAvatar').textContent = username.charAt(0).toUpperCase();
            
            const stats = {
                goals: goals.length,
                streak: streak,
                rate: goals.length ? Math.round((goals.filter(g => g.completed).length / goals.length) * 100) : 0
            };
            
            Object.entries(stats).forEach(([key, value]) => {
                const element = document.getElementById(`profile${key.charAt(0).toUpperCase() + key.slice(1)}`);
                element.textContent = key === 'rate' ? `${value}%` : value;
            });
        }

        function closeProfile() {
            document.getElementById('profilePage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
        }

        function toggleNameChange() {
            const form = document.getElementById('nameChangeForm');
            const currentName = document.getElementById('profileName').textContent;
            const input = document.getElementById('newNameInput');
            
            if (form.classList.contains('active')) {
                form.classList.remove('active');
                input.value = '';
            } else {
                form.classList.add('active');
                input.value = currentName;
                input.focus();
            }
        }

        function showLogoutConfirmation() {
            if (confirm('Are you sure you want to log out?')) {
                localStorage.clear();
                window.location.reload();
            }
        }

        function showDeleteConfirmation() {
            if (confirm('Are you sure you want to delete your account? This action cannot be undone.')) {
                localStorage.clear();
                window.location.reload();
            }
        }

        // Theme definitions
        const themes = [
            {
                name: "Kawaii Pink",
                colors: {
                    primary: "#FFB6C1",
                    secondary: "#FFC0CB",
                    accent: "#FFD1DC",
                    background: "#FFF0F5",
                    text: "#FF69B4",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Sweet Mint",
                colors: {
                    primary: "#98FF98",
                    secondary: "#C1FFC1",
                    accent: "#E0FFE0",
                    background: "#F0FFF0",
                    text: "#3CB371",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Cotton Candy",
                colors: {
                    primary: "#FFB6C1",
                    secondary: "#87CEEB",
                    accent: "#E0FFFF",
                    background: "#F0F8FF",
                    text: "#FF69B4",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Bubblegum",
                colors: {
                    primary: "#FF69B4",
                    secondary: "#FFB6C1",
                    accent: "#FFC0CB",
                    background: "#FFF0F5",
                    text: "#FF1493",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Pastel Rainbow",
                colors: {
                    primary: "#FFB6C1",
                    secondary: "#98FF98",
                    accent: "#87CEEB",
                    background: "#F0F8FF",
                    text: "#FF69B4",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Lavender Dream",
                colors: {
                    primary: "#E6E6FA",
                    secondary: "#D8BFD8",
                    accent: "#DDA0DD",
                    background: "#F8F8FF",
                    text: "#9370DB",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Peach Paradise",
                colors: {
                    primary: "#FFDAB9",
                    secondary: "#FFE4C4",
                    accent: "#FFEFD5",
                    background: "#FFF8DC",
                    text: "#FFA07A",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Mint Chocolate",
                colors: {
                    primary: "#98FF98",
                    secondary: "#D2B48C",
                    accent: "#DEB887",
                    background: "#F5F5DC",
                    text: "#556B2F",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Berry Blast",
                colors: {
                    primary: "#FF69B4",
                    secondary: "#FF1493",
                    accent: "#FFB6C1",
                    background: "#FFF0F5",
                    text: "#C71585",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Ocean Breeze",
                colors: {
                    primary: "#87CEEB",
                    secondary: "#B0E0E6",
                    accent: "#E0FFFF",
                    background: "#F0F8FF",
                    text: "#4682B4",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Strawberry Milk",
                colors: {
                    primary: "#FFB6C1",
                    secondary: "#FFC0CB",
                    accent: "#FFD1DC",
                    background: "#FFF0F5",
                    text: "#FF69B4",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Lemon Drop",
                colors: {
                    primary: "#FFFACD",
                    secondary: "#FFF8DC",
                    accent: "#FFFFE0",
                    background: "#FFFFF0",
                    text: "#DAA520",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Grape Soda",
                colors: {
                    primary: "#E6E6FA",
                    secondary: "#D8BFD8",
                    accent: "#DDA0DD",
                    background: "#F8F8FF",
                    text: "#9370DB",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Marshmallow",
                colors: {
                    primary: "#FFFAFA",
                    secondary: "#F0FFF0",
                    accent: "#F5F5F5",
                    background: "#FFFFFF",
                    text: "#A9A9A9",
                    cardBg: "#F8F8F8"
                }
            },
            {
                name: "Candy Floss",
                colors: {
                    primary: "#FFB6C1",
                    secondary: "#FFC0CB",
                    accent: "#FFD1DC",
                    background: "#FFF0F5",
                    text: "#FF69B4",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Mint Ice Cream",
                colors: {
                    primary: "#98FF98",
                    secondary: "#C1FFC1",
                    accent: "#E0FFE0",
                    background: "#F0FFF0",
                    text: "#3CB371",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Blueberry Yogurt",
                colors: {
                    primary: "#87CEEB",
                    secondary: "#B0E0E6",
                    accent: "#E0FFFF",
                    background: "#F0F8FF",
                    text: "#4682B4",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Peach Melba",
                colors: {
                    primary: "#FFDAB9",
                    secondary: "#FFE4C4",
                    accent: "#FFEFD5",
                    background: "#FFF8DC",
                    text: "#FFA07A",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Lavender Honey",
                colors: {
                    primary: "#E6E6FA",
                    secondary: "#D8BFD8",
                    accent: "#DDA0DD",
                    background: "#F8F8FF",
                    text: "#9370DB",
                    cardBg: "#FFFFFF"
                }
            },
            {
                name: "Rainbow Sherbet",
                colors: {
                    primary: "#FFB6C1",
                    secondary: "#98FF98",
                    accent: "#87CEEB",
                    background: "#F0F8FF",
                    text: "#FF69B4",
                    cardBg: "#FFFFFF"
                }
            }
        ];

        // Initialize settings
        let settings = JSON.parse(localStorage.getItem('settings')) || {
            theme: 'Default Pink',
            fontSize: 'medium',
            dailyReminders: false,
            reminderTime: '09:00'
        };

        // Update theme grid
        function updateThemeGrid() {
            const themeGrid = document.getElementById('themeGrid');
            themeGrid.innerHTML = '';
            
            themes.forEach(theme => {
                const themeOption = document.createElement('div');
                themeOption.className = 'theme-option';
                themeOption.innerHTML = `
                    <div class="theme-preview" style="background: linear-gradient(45deg, ${theme.colors.primary}, ${theme.colors.secondary})"></div>
                    <div class="theme-name">${theme.name}</div>
                `;
                themeOption.onclick = () => applyTheme(theme);
                themeGrid.appendChild(themeOption);
            });
        }

        // Apply theme
        function applyTheme(theme) {
            const root = document.documentElement;
            Object.entries(theme.colors).forEach(([key, value]) => {
                root.style.setProperty(`--${key}`, value);
            });
            document.body.style.backgroundColor = theme.colors.background;
            document.querySelector('.app-container').style.backgroundColor = theme.colors.cardBg;
            settings.theme = theme.name;
            localStorage.setItem('settings', JSON.stringify(settings));
            showNotification('Theme updated successfully!');
        }

        // Update font size
        function updateFontSize() {
            const fontSize = document.getElementById('fontSize').value;
            document.body.style.fontSize = fontSize === 'small' ? '14px' : fontSize === 'large' ? '18px' : '16px';
            settings.fontSize = fontSize;
            localStorage.setItem('settings', JSON.stringify(settings));
        }

        // Update settings
        function updateSettings() {
            settings.dailyReminders = document.getElementById('dailyReminders').checked;
            settings.reminderTime = document.getElementById('reminderTime').value;
            localStorage.setItem('settings', JSON.stringify(settings));

            if (settings.dailyReminders) {
                requestNotificationPermission();
                scheduleGoalNotifications();
            }

            showNotification('Settings updated successfully!', 'success');
        }

        // Export data
        function exportData() {
            const data = {
                goals: goals,
                streak: streak,
                lastCheckIn: lastCheckIn,
                settings: settings
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'pebbleway-data.json';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Import data
        function importData() {
            const file = document.getElementById('importFile').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        goals = data.goals || [];
                        streak = data.streak || 0;
                        lastCheckIn = data.lastCheckIn;
                        settings = data.settings || settings;
                        
                        localStorage.setItem('goals', JSON.stringify(goals));
                        localStorage.setItem('streak', streak);
                        localStorage.setItem('lastCheckIn', lastCheckIn);
                        localStorage.setItem('settings', JSON.stringify(settings));
                        
                        updateGoalsList();
                        applyTheme(themes.find(t => t.name === settings.theme) || themes[0]);
                        updateFontSize();
                        showNotification('Data imported successfully!');
                    } catch (error) {
                        showNotification('Error importing data', 'error');
                    }
                };
                reader.readAsText(file);
            }
        }

        // Reset data
        function resetData() {
            if (confirm('Are you sure you want to reset all data? This action cannot be undone.')) {
                localStorage.clear();
                window.location.reload();
            }
        }

        // Show settings
        function showSettings() {
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('settingsPage').classList.add('active');
            
            // Update settings UI
            document.getElementById('fontSize').value = settings.fontSize;
            document.getElementById('dailyReminders').checked = settings.dailyReminders;
            document.getElementById('reminderTime').value = settings.reminderTime;
            
            updateThemeGrid();
        }

        // Close settings
        function closeSettings() {
            document.getElementById('settingsPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
        }

        // Initialize settings
        updateThemeGrid();
        applyTheme(themes.find(t => t.name === settings.theme) || themes[0]);
        updateFontSize();

        // Initialize the app
        updateGoalsList();

        function showProgress() {
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('progressPage').classList.add('active');
            updateStats(); // Update stats when showing progress page
            updateStreakCalendar(); // Add this line to update the calendar
            updateStreakDisplays(); // Add this line to update streak displays
            loadProgressNotes(); // Add this line to load any saved notes
        }

        function closeProgress() {
            document.getElementById('progressPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
        }

        function updateStreakCalendar() {
            const calendar = document.getElementById('streakCalendar');
            calendar.innerHTML = '';
            
            const today = new Date();
            const daysInMonth = new Date(today.getFullYear(), today.getMonth() + 1, 0).getDate();
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1).getDay();
            
            // Add month and year header
            const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            const monthHeader = document.createElement('div');
            monthHeader.className = 'calendar-header';
            monthHeader.textContent = `${monthNames[today.getMonth()]} ${today.getFullYear()}`;
            calendar.appendChild(monthHeader);
            
            // Add weekday headers
            const weekdays = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            weekdays.forEach(day => {
                const weekdayHeader = document.createElement('div');
                weekdayHeader.className = 'calendar-weekday';
                weekdayHeader.textContent = day;
                calendar.appendChild(weekdayHeader);
            });
            
            // Add empty cells for days before the first of the month
            for (let i = 0; i < firstDay; i++) {
                const emptyDay = document.createElement('div');
                emptyDay.className = 'calendar-day empty';
                calendar.appendChild(emptyDay);
            }
            
            // Add days of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const dayElement = document.createElement('div');
                dayElement.className = 'calendar-day';
                
                const dateStr = new Date(today.getFullYear(), today.getMonth(), day).toDateString();
                const isToday = day === today.getDate();
                const isChecked = lastCheckIn === dateStr;
                const isPast = new Date(today.getFullYear(), today.getMonth(), day) < new Date(today.getFullYear(), today.getMonth(), today.getDate());
                
                if (isToday) {
                    dayElement.classList.add('today');
                }
                if (isChecked) {
                    dayElement.classList.add('checked');
                }
                if (isPast && !isChecked) {
                    dayElement.classList.add('missed');
                }
                
                dayElement.textContent = day;
                
                // Add tooltip with check-in status
                if (isChecked) {
                    dayElement.title = 'Goal completed!';
                } else if (isPast) {
                    dayElement.title = 'Missed day';
                } else if (isToday) {
                    dayElement.title = 'Today';
                } else {
                    dayElement.title = 'Future day';
                }
                
                calendar.appendChild(dayElement);
            }
        }

        function updateStreakDisplays() {
            const bestStreak = parseInt(localStorage.getItem('bestStreak')) || 0;
            document.getElementById('currentStreakDisplay').textContent = `${streak} days`;
            document.getElementById('bestStreakDisplay').textContent = `${bestStreak} days`;
            
            // Update best streak if current streak is higher
            if (streak > bestStreak) {
                localStorage.setItem('bestStreak', streak);
                showNotification('New best streak! üéâ', 'success');
            }
        }

        function saveProgressNotes() {
            const notes = document.getElementById('progressNotes').value;
            const today = new Date().toISOString().split('T')[0];
            localStorage.setItem(`notes_${today}`, notes);
            showNotification('Notes saved successfully!', 'success');
        }

        function loadProgressNotes() {
            const today = new Date().toISOString().split('T')[0];
            const notes = localStorage.getItem(`notes_${today}`) || '';
            document.getElementById('progressNotes').value = notes;
        }

        function updateJournalStyle() {
            const textarea = document.getElementById('journalText');
            const font = document.getElementById('journalFont').value;
            const color = document.getElementById('journalColor').value;
            const size = document.getElementById('journalSize').value;

            // Remove all existing style classes
            textarea.className = '';
            
            // Add new style classes
            textarea.classList.add(`font-${font.toLowerCase().replace(' ', '-')}`);
            if (color !== 'default') {
                textarea.classList.add(`color-${color}`);
            }
            textarea.classList.add(`size-${size}`);

            // Save current style to localStorage
            const currentStyle = {
                font: font,
                color: color,
                size: size
            };
            localStorage.setItem('journalCurrentStyle', JSON.stringify(currentStyle));
        }

        function loadJournalStyle() {
            const savedStyle = JSON.parse(localStorage.getItem('journalCurrentStyle')) || {
                font: 'Quicksand',
                color: 'default',
                size: 'medium'
            };

            document.getElementById('journalFont').value = savedStyle.font;
            document.getElementById('journalColor').value = savedStyle.color;
            document.getElementById('journalSize').value = savedStyle.size;
            updateJournalStyle();
        }

        function showCartoons() {
            const writingCartoon = document.querySelector('.writing-cartoon');
            const readingCartoon = document.querySelector('.reading-cartoon');
            
            // Show writing cartoon when textarea is focused
            const textarea = document.getElementById('journalText');
            textarea.addEventListener('focus', () => {
                writingCartoon.classList.add('active');
            });
            
            textarea.addEventListener('blur', () => {
                writingCartoon.classList.remove('active');
            });

            // Show reading cartoon when hovering over entries
            const entries = document.querySelectorAll('.journal-entry-item');
            entries.forEach(entry => {
                entry.addEventListener('mouseenter', () => {
                    readingCartoon.classList.add('active');
                });
                
                entry.addEventListener('mouseleave', () => {
                    readingCartoon.classList.remove('active');
                });
            });
        }

        function showJournal() {
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('journalPage').classList.add('active');
            loadJournalStyle();
            loadJournalEntries();
            showCartoons();
        }

        function closeJournal() {
            document.getElementById('journalPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
        }

        function loadJournalEntries() {
            const journalEntries = JSON.parse(localStorage.getItem('journalEntries') || '{}');
            const entriesList = document.getElementById('journalEntries');
            entriesList.innerHTML = '';

            const sortedDates = Object.keys(journalEntries).sort().reverse();

            sortedDates.forEach(date => {
                const entryDiv = document.createElement('div');
                entryDiv.className = 'journal-entry-item';
                entryDiv.dataset.date = date;
                
                const formattedDate = new Date(date).toLocaleDateString('en-US', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });

                const entry = journalEntries[date];
                const content = typeof entry === 'string' ? entry : entry.content;
                const font = typeof entry === 'string' ? 'Quicksand' : entry.font;
                const color = typeof entry === 'string' ? 'default' : entry.color;
                const size = typeof entry === 'string' ? 'medium' : entry.size;

                entryDiv.innerHTML = `
                    <div class="journal-entry-actions">
                        <button class="journal-entry-action" onclick="editJournalEntry('${date}')">Edit</button>
                        <button class="journal-entry-action delete" onclick="deleteJournalEntry('${date}')">Delete</button>
                    </div>
                    <div class="journal-entry-date">
                        <span>${formattedDate}</span>
                        <span class="entry-style">${font} ‚Ä¢ ${size}</span>
                    </div>
                    <div class="journal-entry-content font-${font.toLowerCase().replace(' ', '-')} ${color !== 'default' ? 'color-' + color : ''} size-${size}">
                        ${content}
                    </div>
                `;
                entriesList.appendChild(entryDiv);
            });

            // Load today's entry if it exists
            const today = new Date().toISOString().split('T')[0];
            const todayEntry = journalEntries[today];
            if (todayEntry) {
                document.getElementById('journalText').value = typeof todayEntry === 'string' ? todayEntry : todayEntry.content;
                if (typeof todayEntry !== 'string') {
                    document.getElementById('journalFont').value = todayEntry.font;
                    document.getElementById('journalColor').value = todayEntry.color;
                    document.getElementById('journalSize').value = todayEntry.size;
                    updateJournalStyle();
                }
            }

            // Add emoji reactions to entries
            const entryElements = document.querySelectorAll('.journal-entry-item');
            entryElements.forEach(entry => {
                addEmojiReaction(entry);
            });
        }

        function clearJournalEntry() {
            if (confirm('Are you sure you want to clear this entry?')) {
                document.getElementById('journalText').value = '';
                updateJournalStyle();
            }
        }

        function editJournalEntry(date) {
            const entries = JSON.parse(localStorage.getItem('journalEntries') || '{}');
            const entry = entries[date];
            
            document.getElementById('journalText').value = entry.content;
            document.getElementById('journalFont').value = entry.font;
            document.getElementById('journalColor').value = entry.color;
            document.getElementById('journalSize').value = entry.size;
            updateJournalStyle();
            
            // Scroll to the entry form
            document.querySelector('.journal-entry').scrollIntoView({ behavior: 'smooth' });
        }

        function deleteJournalEntry(date) {
            if (confirm('Are you sure you want to delete this entry?')) {
                const entries = JSON.parse(localStorage.getItem('journalEntries') || '{}');
                delete entries[date];
                localStorage.setItem('journalEntries', JSON.stringify(entries));
                loadJournalEntries();
                showNotification('Entry deleted successfully');
            }
        }

        function filterJournalEntries() {
            const searchText = document.getElementById('journalSearch').value.toLowerCase();
            const entries = document.querySelectorAll('.journal-entry-item');
            
            entries.forEach(entry => {
                const content = entry.querySelector('.journal-entry-content').textContent.toLowerCase();
                const date = entry.querySelector('.journal-entry-date').textContent.toLowerCase();
                
                if (content.includes(searchText) || date.includes(searchText)) {
                    entry.style.display = 'block';
                } else {
                    entry.style.display = 'none';
                }
            });
        }

        function sortJournalEntries() {
            const sortOrder = document.getElementById('journalSort').value;
            const entriesList = document.getElementById('journalEntries');
            const entryElements = Array.from(entriesList.children);
            
            entryElements.sort((a, b) => {
                const dateA = new Date(a.dataset.date);
                const dateB = new Date(b.dataset.date);
                return sortOrder === 'newest' ? dateB - dateA : dateA - dateB;
            });
            
            entryElements.forEach(entry => entriesList.appendChild(entry));
        }

        function addEmojiReaction(entryDiv) {
            const emojis = ['üåü', 'üí™', 'üéØ', '‚ú®', 'üí´', 'üåà', 'üé®', 'üìù'];
            const randomEmoji = emojis[Math.floor(Math.random() * emojis.length)];
            
            const emojiSpan = document.createElement('span');
            emojiSpan.className = 'cartoon-emoji';
            emojiSpan.textContent = randomEmoji;
            emojiSpan.style.left = Math.random() * 80 + 10 + '%';
            emojiSpan.style.top = Math.random() * 80 + 10 + '%';
            
            entryDiv.appendChild(emojiSpan);
            
            // Show emoji with delay
            setTimeout(() => {
                emojiSpan.classList.add('active');
            }, 300);
        }

        // Add these functions to your existing JavaScript
        function showAnimalCartoons() {
            const capybara = document.querySelector('.capybara-writing');
            const panda = document.querySelector('.panda-reading');
            
            // Show capybara when textarea is focused
            const textarea = document.getElementById('journalText');
            textarea.addEventListener('focus', () => {
                capybara.classList.add('active');
            });
            
            textarea.addEventListener('blur', () => {
                capybara.classList.remove('active');
            });

            // Show panda when hovering over entries
            const entries = document.querySelectorAll('.journal-entry-item');
            entries.forEach(entry => {
                entry.addEventListener('mouseenter', () => {
                    panda.classList.add('active');
                });
                
                entry.addEventListener('mouseleave', () => {
                    panda.classList.remove('active');
                });
            });
        }

        // Update the showJournal function
        function showJournal() {
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('journalPage').classList.add('active');
            loadJournalStyle();
            loadJournalEntries();
            showAnimalCartoons(); // Initialize animal cartoons
        }

        // Add random animal reactions to entries
        function addAnimalReaction(entryDiv) {
            const animals = [
                'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23A67C52"/><circle cx="35" cy="40" r="5" fill="%23000"/><circle cx="65" cy="40" r="5" fill="%23000"/><path d="M30 60 Q50 70 70 60" stroke="%23000" fill="none" stroke-width="2"/></svg>',
                'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23FFF"/><circle cx="35" cy="40" r="5" fill="%23000"/><circle cx="65" cy="40" r="5" fill="%23000"/><circle cx="35" cy="40" r="2" fill="%23FFF"/><circle cx="65" cy="40" r="2" fill="%23FFF"/><path d="M30 60 Q50 70 70 60" stroke="%23000" fill="none" stroke-width="2"/><circle cx="50" cy="30" r="8" fill="%23000"/></svg>'
            ];
            const randomAnimal = animals[Math.floor(Math.random() * animals.length)];
            
            const animalDiv = document.createElement('div');
            animalDiv.className = 'animal-reaction';
            animalDiv.style.backgroundImage = `url('${randomAnimal}')`;
            animalDiv.style.left = Math.random() * 80 + 10 + '%';
            animalDiv.style.top = Math.random() * 80 + 10 + '%';
            
            entryDiv.appendChild(animalDiv);
            
            // Show animal with delay
            setTimeout(() => {
                animalDiv.classList.add('active');
            }, 300);
        }

        // Update loadJournalEntries to include animal reactions
        function loadJournalEntries() {
            // ... existing loadJournalEntries code ...
            
            // Add animal reactions to entries
            const entries = document.querySelectorAll('.journal-entry-item');
            entries.forEach(entry => {
                addAnimalReaction(entry);
            });
        }

        // Add notification permission request and handling
        async function requestNotificationPermission() {
            try {
                const permission = await Notification.requestPermission();
                if (permission === 'granted') {
                    showNotification('Notifications enabled! You\'ll receive reminders for your goals.', 'success');
                    localStorage.setItem('notificationsEnabled', 'true');
                } else {
                    showNotification('Please enable notifications to receive goal reminders.', 'error');
                    localStorage.setItem('notificationsEnabled', 'false');
                }
            } catch (error) {
                console.error('Error requesting notification permission:', error);
            }
        }

        // Schedule notifications for goals
        function scheduleGoalNotifications() {
            if (!('Notification' in window) || Notification.permission !== 'granted') {
                return;
            }

            // Clear existing notifications
            if ('serviceWorker' in navigator) {
                navigator.serviceWorker.ready.then(registration => {
                    registration.getNotifications().then(notifications => {
                        notifications.forEach(notification => notification.close());
                    });
                });
            }

            // Schedule notifications for each goal
            goals.forEach(goal => {
                if (!goal.completed) {
                    const now = new Date();
                    const reminderTime = new Date(now);
                    reminderTime.setHours(9, 0, 0, 0); // Set reminder for 9 AM

                    if (now > reminderTime) {
                        reminderTime.setDate(reminderTime.getDate() + 1);
                    }

                    const timeUntilReminder = reminderTime.getTime() - now.getTime();

                    setTimeout(() => {
                        new Notification('Goal Reminder', {
                            body: `Don't forget to check in for your goal: ${goal.title}`,
                            icon: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23FFB6C1"/><circle cx="35" cy="40" r="5" fill="%23000"/><circle cx="65" cy="40" r="5" fill="%23000"/><path d="M30 60 Q50 70 70 60" stroke="%23000" fill="none" stroke-width="2"/></svg>',
                            badge: 'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="45" fill="%23FFB6C1"/></svg>',
                            tag: `goal-${goal.title}`,
                            requireInteraction: true
                        });
                    }, timeUntilReminder);
                }
            });
        }

        // Initialize notifications when app starts
        document.addEventListener('DOMContentLoaded', () => {
            if (localStorage.getItem('notificationsEnabled') === 'true') {
                requestNotificationPermission();
            }
        });

        // Update the settings section HTML
        const settingsSection = document.querySelector('.settings-section:nth-child(2)');
        settingsSection.innerHTML = `
            <h2 class="settings-title">Notifications</h2>
            <div class="settings-group">
                <label class="settings-label">Daily Reminders</label>
                <label class="settings-toggle">
                    <input type="checkbox" id="dailyReminders" onchange="updateSettings()">
                    <span class="settings-slider"></span>
                </label>
            </div>
            <div class="settings-group">
                <label class="settings-label">Reminder Time</label>
                <input type="time" class="settings-input" id="reminderTime" onchange="updateSettings()">
            </div>
            <div class="settings-group">
                <label class="settings-label">Notification Sound</label>
                <select class="settings-select" id="notificationSound" onchange="updateSettings()">
                    <option value="default">Default</option>
                    <option value="gentle">Gentle</option>
                    <option value="upbeat">Upbeat</option>
                    <option value="none">None</option>
                </select>
            </div>
        `;

        // Add service worker registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/service-worker.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful');
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }

        // Add these functions to your existing JavaScript
        function showLogin() {
            document.getElementById('signupPage').classList.remove('active');
            document.getElementById('loginPage').classList.add('active');
        }

        function showSignup() {
            document.getElementById('loginPage').classList.remove('active');
            document.getElementById('signupPage').classList.add('active');
        }

        function handleLogin(event) {
            event.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            const errorElement = document.getElementById('loginError');

            // Get users from localStorage
            const users = JSON.parse(localStorage.getItem('users')) || {};
            
            if (users[email] && users[email].password === password) {
                // Store current user
                localStorage.setItem('currentUser', JSON.stringify({
                    name: users[email].name,
                    email: email
                }));

                // Show success notification
                showNotification('Welcome back!', 'success');

                // Redirect to home page
                document.getElementById('loginPage').classList.remove('active');
                document.getElementById('homePage').classList.add('active');
            } else {
                errorElement.textContent = 'Invalid email or password';
            }
        }

        function handleSignup(event) {
            event.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;
            const confirmPassword = document.getElementById('signupConfirmPassword').value;
            const errorElement = document.getElementById('signupError');

            // Validate passwords match
            if (password !== confirmPassword) {
                errorElement.textContent = 'Passwords do not match';
                return;
            }

            // Get existing users
            const users = JSON.parse(localStorage.getItem('users')) || {};

            // Check if email already exists
            if (users[email]) {
                errorElement.textContent = 'Email already registered';
                return;
            }

            // Add new user
            users[email] = {
                name: name,
                password: password
            };

            // Save users
            localStorage.setItem('users', JSON.stringify(users));

            // Store current user
            localStorage.setItem('currentUser', JSON.stringify({
                name: name,
                email: email
            }));

            // Show success notification
            showNotification('Account created successfully!', 'success');

            // Redirect to home page
            document.getElementById('signupPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
        }

        // Check authentication on page load
        document.addEventListener('DOMContentLoaded', () => {
            const currentUser = JSON.parse(localStorage.getItem('currentUser'));
            
            if (!currentUser) {
                // Show login page if no user is logged in
                document.getElementById('homePage').classList.remove('active');
                document.getElementById('loginPage').classList.add('active');
            } else {
                // Update UI with user info
                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profileEmail').textContent = currentUser.email;
                document.getElementById('profileAvatar').textContent = currentUser.name.charAt(0).toUpperCase();
            }
        });

        // Add logout functionality
        function showLogoutConfirmation() {
            if (confirm('Are you sure you want to log out?')) {
                localStorage.removeItem('currentUser');
                window.location.reload();
            }
        }

        // Add this script at the end of your JS
        function updateSelectedFileName() {
            const input = document.getElementById('importFile');
            const fileNameSpan = document.getElementById('selectedFileName');
            fileNameSpan.textContent = input.files.length ? input.files[0].name : '';
        }

        function closeSettings() {
            document.getElementById('settingsPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
        }

        function closeProgress() {
            document.getElementById('progressPage').classList.remove('active');
            document.getElementById('homePage').classList.add('active');
        }

        function showProfile() {
            document.getElementById('homePage').classList.remove('active');
            document.getElementById('profilePage').classList.add('active');
            
            // Update profile stats
            const streak = parseInt(localStorage.getItem('streak')) || 0;
            const totalGoals = goals.length;
            const completedGoals = goals.filter(goal => goal.completed).length;
            const completionRate = totalGoals > 0 ? Math.round((completedGoals / totalGoals) * 100) : 0;
            
            document.getElementById('profileStreak').textContent = streak;
            document.getElementById('profileRate').textContent = `${completionRate}%`;
        }

        function saveJournalEntry() {
            const content = document.getElementById('journalText').value.trim();
            if (!content) {
                showNotification('Please write something before saving', 'error');
                return;
            }

            const today = new Date().toISOString().split('T')[0];
            const font = document.getElementById('journalFont').value;
            const color = document.getElementById('journalColor').value;
            const size = document.getElementById('journalSize').value;

            const entries = JSON.parse(localStorage.getItem('journalEntries') || '{}');
            entries[today] = {
                content,
                font,
                color,
                size
            };

            localStorage.setItem('journalEntries', JSON.stringify(entries));
            loadJournalEntries();
            showNotification('Entry saved successfully!');
        }

        // Add these functions to your existing JavaScript
        function toggleDarkMode() {
            const isDarkMode = document.getElementById('darkMode').checked;
            document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
            localStorage.setItem('darkMode', isDarkMode);
            showNotification('Theme updated successfully!');
        }

        // Add this to your DOMContentLoaded event listener
        document.addEventListener('DOMContentLoaded', function() {
            // ... existing code ...
            
            // Initialize dark mode
            const isDarkMode = localStorage.getItem('darkMode') === 'true';
            document.getElementById('darkMode').checked = isDarkMode;
            document.documentElement.setAttribute('data-theme', isDarkMode ? 'dark' : 'light');
        });
    </script>
</body>
</html> 